{% comment %}
  Custom header for Wookie theme with simplified, dynamic dropdown menus.
  Pulls navigation from Shopify's Main Menu (linklists.main-menu).
  Replaces mega menu with hover-based dropdowns for TRUCKS, VANS, and WALDOCH GEAR.
  Uses Wookie's default styles for search, cart, and account icons.
{% endcomment %}

<div class="tt-header-holder" style="background: #000; color: #fff;"> <!-- Match your image's black background -->
  <!-- Logo -->
  <div class="tt-col-obj tt-obj-logo menu-in-center" itemscope itemtype="http://schema.org/Organization">
    <a href="{{ routes.root_url }}" class="tt-logo" itemprop="url">
      <img src="https://store.waldoch.com/cdn/shop/files/truck_and_vans_accessories-01_200x.png?v=1613604656" 
           srcset="//store.waldoch.com/cdn/shop/files/truck_and_vans_accessories-01_200x.png?v=1613604656 1x, //store.waldoch.com/cdn/shop/files/truck_and_vans_accessories-01_400x.png?v=1613604656 2x" 
           alt="Waldoch Logo" class="tt-retina" itemprop="logo">
    </a>
  </div>

  <!-- Mobile Menu Toggle -->
  <button class="tt-mobile-menu-toggle">
    <i class="icon-f-83"></i> <!-- Replace with Wookie theme's hamburger icon class if needed -->
  </button>

  <!-- Navigation (Dynamic from Main Menu) -->
  <div class="tt-desctop-parent-menu tt-parent-box">
    <div class="tt-desctop-menu">
      <nav>
        <ul>
          {% for link in linklists.main-menu.links %}
            <li{% if link.links != blank %} class="dropdown"{% endif %}>
              <a href="{{ link.url }}" style="color: #fff; text-transform: uppercase;">{{ link.title }}</a>
              {% if link.links != blank %}
                <div class="dropdown-menu">
                  <ul>
                    {% for child_link in link.links %}
                      <li><a href="{{ child_link.url }}">{{ child_link.title }}</a></li>
                    {% endfor %}
                  </ul>
                </div>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </nav>
    </div>
  </div>

  <!-- Financing Message (Affirm) -->
  <div class="tt-financing affirm-as-low-as" data-page-type="header" data-amount="0">
    Pay with <span class="__affirm-logo __affirm-logo-blue">Affirm</span> on orders over $50. 
    <a class="affirm-modal-trigger" aria-label="See if you qualify" href="javascript:void(0)">Prequalify Now</a>
  </div>

  <!-- Search, Cart, Account -->
  <div class="tt-col-obj tt-obj-options obj-move-right">
    <!-- Search -->
    <div class="tt-desctop-parent-search tt-parent-box">
      <div class="tt-search tt-dropdown-obj">
        <button class="tt-dropdown-toggle" data-tooltip="Search" data-tposition="bottom">
          <i class="icon-f-85"></i>
        </button>
        <div class="tt-dropdown-menu">
          <div class="container">
            <form action="{{ routes.search_url }}" method="get" role="search">
              <div class="tt-col">
                <input type="hidden" name="type" value="product">
                <input class="tt-search-input" type="search" name="q" placeholder="SEARCH PRODUCTS..." aria-label="SEARCH PRODUCTS..." autocomplete="off">
                <button type="submit" class="tt-btn-search"></button>
              </div>
              <div class="tt-col">
                <button class="tt-btn-close icon-f-84"></button>
              </div>
              <div class="tt-info-text">What are you Looking for?</div>
              <div class="search-results" style="display: none;"></div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- Cart -->
    <div class="tt-desctop-parent-cart tt-parent-box">
      <div class="tt-cart tt-dropdown-obj">
        <button class="tt-dropdown-toggle" data-tooltip="Cart" data-tposition="bottom">
          <i class="icon-f-39"></i>
          <span class="tt-badge-cart hide">0</span>
        </button>
        <div class="tt-dropdown-menu">
          <div class="tt-mobile-add">
            <h6 class="tt-title">SHOPPING CART</h6>
            <button class="tt-close">CLOSE</button>
          </div>
          <div class="tt-dropdown-inner">
            <div class="tt-cart-layout">
              <div class="tt-cart-content">
                <a href="{{ routes.cart_url }}" class="tt-cart-empty" title="VIEW CART">
                  <i class="icon-f-39"></i>
                  <p>No Products in the Cart</p>
                </a>
                <div class="tt-cart-box hide">
                  <div class="tt-cart-list"></div>
                  <div class="tt-cart-total-row">
                    <div class="tt-cart-total-title">TOTAL:</div>
                    <div class="tt-cart-total-price">$0.00</div>
                  </div>
                  <div class="tt-cart-btn">
                    <div class="tt-item">
                      <a href="/checkout" class="btn">PROCEED TO CHECKOUT</a>
                    </div>
                    <div class="tt-item">
                      <a href="{{ routes.cart_url }}" class="btn-link-02">VIEW CART</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Account -->
    <div class="tt-desctop-parent-account tt-parent-box">
      <div class="tt-account tt-dropdown-obj">
        <button class="tt-dropdown-toggle" data-tooltip="My Account" data-tposition="bottom">
          <i class="icon-f-94"></i>
        </button>
        <div class="tt-dropdown-menu">
          <div class="tt-mobile-add">
            <button class="tt-close">Close</button>
          </div>
          <div class="tt-dropdown-inner">
            <ul>
              <li><a href="{{ routes.account_login_url }}"><i class="icon-f-77"></i>Sign In</a></li>
              <li><a href="{{ routes.account_register_url }}"><i class="icon-f-94"></i>Register</a></li>
              <li><a href="/checkout"><i class="icon-f-68"></i>Checkout</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Mobile menu toggle
  document.querySelector('.tt-mobile-menu-toggle').addEventListener('click', function() {
    document.querySelector('.tt-desctop-menu').classList.toggle('active');
  });

  // Dropdown toggle for mobile
  document.querySelectorAll('.tt-desctop-menu nav ul li.dropdown').forEach(function(dropdown) {
    dropdown.querySelector('a').addEventListener('click', function(e) {
      if (window.innerWidth <= 768) {
        e.preventDefault();
        dropdown.classList.toggle('active');
      }
    });
  });

  // Toggle search, cart, account dropdowns
  document.querySelectorAll('.tt-dropdown-toggle').forEach(function(toggle) {
    toggle.addEventListener('click', function() {
      const parent = this.parentElement;
      parent.classList.toggle('active');
    });
  });
</script>